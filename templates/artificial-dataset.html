{% extends "base.html" %} {% block title %}Artificial Dataset - LLM Moral
Judgment Study{% endblock %} {% block header_title %}Artificial Agent Dataset
Analysis{% endblock %} {% block extra_head %}
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  .viz-container {
    display: flex;
    flex-direction: column;
    gap: 60px;
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
  }

  .chart-section h3 {
    color: #8c78c8;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 24px;
    text-align: center;
  }

  .chart-description {
    color: #aaa;
    text-align: center;
    margin-bottom: 25px;
    font-size: 14px;
    line-height: 1.6;
  }

  .chart-container {
    display: flex;
    justify-content: center;
    min-height: 480px;
  }

  .axis text {
    fill: white;
    font-size: 12px;
  }

  .axis line,
  .axis path {
    stroke: rgba(255, 255, 255, 0.3);
  }

  .grid line {
    stroke: rgba(255, 255, 255, 0.1);
  }

  .bar-group:hover {
    opacity: 0.8;
    cursor: pointer;
  }

  .legend {
    font-size: 13px;
  }

  .legend text {
    fill: white;
  }

  .legend rect {
    rx: 3;
  }

  .tooltip-chart {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    pointer-events: none;
    opacity: 0;
    font-size: 13px;
    border: 1px solid rgba(27, 109, 128, 0.5);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 1000;
  }

  .tooltip-chart strong {
    color: #8c78c8;
    display: block;
    margin-bottom: 6px;
    font-size: 14px;
  }

  .tooltip-chart .value {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin: 4px 0;
  }

  .tooltip-chart .label {
    color: #aaa;
  }
</style>
{% endblock %} {% block content %}

<!-- WHITE CENTERED PAGE TITLE -->
<h1 class="page-title-white">ARTIFICIAL DATASET</h1>

<section class="page-content">
  <article class="content-block">
    <h2>Artificial Agent Dataset</h2>
    <p>
      Analysis of artificial CNI estimates across different personality trait
      levels for LLaMA-3 agents with systematically varied Big 5 personality
      profiles.
    </p>
  </article>

  <div class="viz-container">
    <div class="chart-section">
      <h3>CNI parameters by Openness</h3>
      <p class="chart-description">
        How do the sensibility to consequences (C), sensibility to moral norms
        (N), and general preference for inaction (I) of artificial agents vary
        across different levels of openness to experience?
      </p>
      <div class="chart-container" id="chart1"></div>
    </div>

    <div class="chart-section">
      <h3>CNI Parameters by Conscientiousness</h3>
      <p class="chart-description">
        How do the sensibility to consequences (C), sensibility to moral norms
        (N), and general preference for inaction (I) of artificial agents vary
        across different levels of conscientiousness?
      </p>
      <div class="chart-container" id="chart2"></div>
    </div>

    <div class="chart-section">
      <h3>CNI Parameters by Extraversion</h3>
      <p class="chart-description">
        How do the sensibility to consequences (C), sensibility to moral norms
        (N), and general preference for inaction (I) of artificial agents vary
        across different levels of extraversion?
      </p>
      <div class="chart-container" id="chart3"></div>
    </div>

    <div class="chart-section">
      <h3>CNI Parameters by Agreeableness</h3>
      <p class="chart-description">
        How do the sensibility to consequences (C), sensibility to moral norms
        (N), and general preference for inaction (I) of artificial agents vary
        across different levels of agreeableness?
      </p>
      <div class="chart-container" id="chart4"></div>
    </div>

    <div class="chart-section">
      <h3>CNI Parameters by Neuroticism</h3>
      <p class="chart-description">
        How do the sensibility to consequences (C), sensibility to moral norms
        (N), and general preference for inaction (I) of artificial agents vary
        across different levels of neuroticism?
      </p>
      <div class="chart-container" id="chart5"></div>
    </div>
  </div>

  <div class="tooltip-chart" id="tooltip"></div>
</section>
{% endblock %} {% block extra_scripts %}
<script>
  let artificialData = [];

  fetch("/api/artificial-data")
    .then((response) => response.json())
    .then((data) => {
      artificialData = data;
      console.log(
        "Loaded artificial data:",
        artificialData.length,
        "participants"
      );
      createAllCharts();
    })
    .catch((error) => {
      console.error("Error loading data:", error);
      document.querySelectorAll(".chart-container").forEach((container) => {
        container.innerHTML =
          '<p style="color: white; text-align: center;">Error loading data. Please check console.</p>';
      });
    });

  function createAllCharts() {
    createCNIByTraitChart("Open", "Openness", "#chart1");
    createCNIByTraitChart("Con", "Conscientiousness", "#chart2");
    createCNIByTraitChart("Extra", "Extraversion", "#chart3");
    createCNIByTraitChart("Agree", "Agreeableness", "#chart4");
    createCNIByTraitChart("Neuro", "Neuroticism", "#chart5");
  }

  function createCNIByTraitChart(traitKey, traitName, containerId) {
    const bins = ["Very Low", "Low", "Medium", "High", "Very High"];

    const sortedValues = artificialData
      .map((d) => d[traitKey])
      .sort((a, b) => a - b);
    const p20 = d3.quantile(sortedValues, 0.2);
    const p40 = d3.quantile(sortedValues, 0.4);
    const p60 = d3.quantile(sortedValues, 0.6);
    const p80 = d3.quantile(sortedValues, 0.8);

    const binnedData = artificialData.map((d) => ({
      ...d,
      bin:
        d[traitKey] <= p20
          ? "Very Low"
          : d[traitKey] <= p40
          ? "Low"
          : d[traitKey] <= p60
          ? "Medium"
          : d[traitKey] <= p80
          ? "High"
          : "Very High",
    }));

    const aggregated = bins.map((bin) => {
      const filtered = binnedData.filter((d) => d.bin === bin);
      return {
        bin: bin,
        C: d3.mean(filtered, (d) => d.C_artificial),
        N: d3.mean(filtered, (d) => d.N_artificial),
        I: d3.mean(filtered, (d) => d.I_artificial),
        count: filtered.length,
      };
    });

    const margin = { top: 20, right: 30, bottom: 90, left: 60 };
    const width = 800 - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;

    const svg = d3
      .select(containerId)
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    const x0 = d3.scaleBand().domain(bins).range([0, width]).padding(0.2);
    const x1 = d3
      .scaleBand()
      .domain(["C", "N", "I"])
      .range([0, x0.bandwidth()])
      .padding(0.05);
    const y = d3.scaleLinear().domain([0, 1]).nice().range([height, 0]);

    // Website color palette: teal, purple, yellow
    const colors = {
      C: "#1b6d80", // Teal (Consequences)
      N: "#8c78c8", // Purple (Norms)
      I: "#f8d697", // Yellow (Inaction)
    };

    svg
      .append("g")
      .attr("class", "grid")
      .call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(""));
    svg
      .append("g")
      .attr("class", "axis")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x0))
      .selectAll("text")
      .style("fill", "white");
    svg.append("g").attr("class", "axis").call(d3.axisLeft(y).ticks(5));

    svg
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left)
      .attr("x", 0 - height / 2)
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .style("fill", "white")
      .style("font-size", "14px")
      .text("Average Score");

    svg
      .append("text")
      .attr("x", width / 2)
      .attr("y", height + 35)
      .style("text-anchor", "middle")
      .style("fill", "white")
      .style("font-size", "14px")
      .text(`${traitName} Level`);

    const tooltip = d3.select("#tooltip");
    const binGroups = svg
      .selectAll(".bin-group")
      .data(aggregated)
      .enter()
      .append("g")
      .attr("class", "bin-group")
      .attr("transform", (d) => `translate(${x0(d.bin)},0)`);

    ["C", "N", "I"].forEach((param) => {
      binGroups
        .append("rect")
        .attr("x", x1(param))
        .attr("y", (d) => y(d[param]))
        .attr("width", x1.bandwidth())
        .attr("height", (d) => height - y(d[param]))
        .attr("fill", colors[param])
        .attr("opacity", 0.85)
        .style("cursor", "pointer")
        .on("mouseover", function (event, d) {
          d3.select(this).transition().duration(200).attr("opacity", 1);
          tooltip
            .style("opacity", 1)
            .html(
              `<strong>${traitName}: ${
                d.bin
              }</strong><br><strong style="color: ${
                colors[param]
              };">${param} Parameter:</strong> ${d[param].toFixed(
                3
              )}<br><small>n = ${d.count} participants</small>`
            );
        })
        .on("mousemove", function (event) {
          tooltip
            .style("left", event.pageX + 15 + "px")
            .style("top", event.pageY - 15 + "px");
        })
        .on("mouseout", function () {
          d3.select(this).transition().duration(200).attr("opacity", 0.85);
          tooltip.style("opacity", 0);
        });

      binGroups
        .append("text")
        .attr("class", "bar-label")
        .attr("x", x1(param) + x1.bandwidth() / 2)
        .attr("y", (d) => y(d[param]) - 5)
        .attr("text-anchor", "middle")
        .text((d) => d[param].toFixed(2))
        .style("font-size", "10px")
        .style("fill", "white");
    });

    // Legend positioned below graph
    const legend = svg
      .append("g")
      .attr("transform", `translate(${width / 2 - 150}, ${height + 60})`);
    const legendItems = [
      { label: "Consequences", color: colors.C },
      { label: "Norms", color: colors.N },
      { label: "Inaction", color: colors.I },
    ];

    legendItems.forEach((item, i) => {
      const g = legend
        .append("g")
        .attr("transform", `translate(${i * 100}, 0)`);
      g.append("rect")
        .attr("width", 12)
        .attr("height", 12)
        .attr("fill", item.color)
        .attr("opacity", 0.85);
      g.append("text")
        .attr("x", 18)
        .attr("y", 10)
        .text(item.label)
        .style("font-size", "10px")
        .style("fill", "white");
    });
  }
</script>
{% endblock %}
